"use strict";(self.webpackChunkaviator=self.webpackChunkaviator||[]).push([[779],{2779:(W,C,o)=>{o.r(C),o.d(C,{CartModule:()=>z});var f=o(6895),e=o(4650),u=o(8252),T=o(4004),S=o(3900),d=o(8505),g=o(3172),A=o(6788),P=o(3413),x=o.n(P),c=o(5092),v=o(1135),p=o(1081),M=o(9653),w=o(7371),R=o(427),$=o(6261),N=o(2215),m=o(9549),Z=o(4144),y=o(4859),I=o(7392),G=o(4850),h=o(4006);let O=(()=>{class t{constructor(n,i,a,r,s,k){this.router=n,this.store=i,this.cartApiService=a,this.userService=r,this.editModeService=s,this.dateService=k,this.userId=localStorage.getItem(c.E1)||"",this.currency$=this.store.select(A.zT),this.isCodeApplied=!1,this.selectedRows$=new v.X(0),this.isPaymentDisabled$=new v.X(!0),this.colDefs=[{headerName:"No.",checkboxSelection:!0,headerCheckboxSelection:!0,onCellClicked:this.onCellClicked.bind(this),width:120,showDisabledCheckboxes:!0,cellStyle:{color:"#0090BD",fontWeight:"700"},headerClass:"ag-header-cell--centered",valueGetter:B},{headerName:"Flight",cellRenderer:E},{headerName:"Trip Type",width:140,valueGetter:J,sortable:!0,unSortIcon:!0},{headerName:"Date & Time",minWidth:230,cellRenderer:U},{headerName:"Passengers",width:140,cellRenderer:j},{headerName:"Price",width:120,field:"totalAmount",cellStyle:{color:"#7F8906"},sortable:!0,unSortIcon:!0,cellRenderer:this.priceRenderer.bind(this)},{width:100,editable:!1,cellEditorPopup:!0,colId:"moreActions",cellRenderer:this.actionCellRenderer.bind(this),cellStyle:{cursor:"pointer",opacity:"0.5",display:"flex",flexDirection:"row",justifyContent:"space-between"},onCellClicked:this.onActionMenuClicked.bind(this),cellEditor:"agSelectCellEditor"}],this.defaultColDef={resizable:!0,autoHeight:!0,wrapText:!0,wrapHeaderText:!0,autoHeaderHeight:!0,cellStyle:{padding:"1rem",lineHeight:"1.5rem",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"500",textAlign:"center"},cellClass:"cellCenter",onCellClicked:this.onSelectionChanged.bind(this)},this.navigationSubscription=this.router.events.subscribe(Q=>{Q instanceof u.m2&&localStorage.removeItem(c.qi)})}ngOnInit(){this.currency$.subscribe(n=>{this.currency=x()(n)})}ngOnDestroy(){this.navigationSubscription&&this.navigationSubscription.unsubscribe()}onGridReady(n){this.user$=this.userService.getUserById(this.userId),this.user$.subscribe(i=>{this.promoCode=i.promoCode,this.isCodeApplied=i.isCodeApplied||!1}),this.trips$=this.cartApiService.getUnpaidTripsByUserId(this.userId),this.trips$.subscribe(i=>{this.cartCount=i.length,this.cartApiService.cartCount$.next(this.cartCount),this.isPaymentDisabled$.next(0===i.length)}),this.calculateTotalPrice(1),this.selectedRows$.next(this.agGrid.api.getSelectedNodes().length)}onCellClicked(n){this.selectedRows$.next(this.agGrid.api.getSelectedNodes().length)}onSelectionChanged(n){this.selectedRows$.next(this.agGrid.api.getSelectedNodes().length)}priceRenderer(n){return`${this.currency} ${Math.round(n.data.totalCalculatedAmount)}`}actionCellRenderer(n){const i=document.createElement("div");return i.innerHTML='\n      <div class="material-icons" title="Edit" data-action="edit">edit</div>\n      <div class="material-icons" title="Delete" data-action="delete">delete</div>\n    ',i}calculateTotalPrice(n=1){this.totalPrice$=this.trips$.pipe((0,T.U)(i=>{const a=i.reduce((r,s)=>r+(s.totalCalculatedAmount||0),0);return Math.round(a*n)}))}onActionMenuClicked(n){if(this.selectedRows=this.agGrid?.gridOptions?.api?.getSelectedNodes().length,"moreActions"===n.column.colId&&n.event.target.dataset.action){const i=n.event.target.dataset.action,a=n.node.data.id;"edit"===i&&(localStorage.setItem(c.qi,a),this.cartApiService.getTrip(a).subscribe(s=>{this.store.dispatch((0,p.Hr)({...s})),this.router.navigate(["flights"])}),this.editModeService.isEditButtonVisible$.next(!0)),"delete"===i&&this.cartApiService.deleteTrip(a,this.userId).pipe((0,S.w)(()=>this.cartApiService.getUnpaidTripsByUserId(this.userId)),(0,d.b)(()=>this.cartCount=this.cartCount-1),(0,d.b)(()=>this.cartApiService.cartCount$.next(this.cartCount)),(0,d.b)(()=>this.calculateTotalPrice(1)),(0,d.b)(()=>this.store.dispatch((0,p.Yn)())),(0,d.b)(()=>localStorage.removeItem(c.qi)),(0,d.b)(()=>n.api.applyTransaction({remove:[n.node.data]}))).subscribe()}}addNewTrip(){this.router.navigate(["main"]),localStorage.removeItem(c.qi)}applyPromoCode(){this.promoCode&&!this.isCodeApplied?(this.calculateTotalPrice(.95),this.isCodeApplied=!0,this.trips$=this.cartApiService.applyPromoCode(this.userId,.95),alert(`Promo Code "${this.promoCode}" with a 5% discount will be applied!`)):this.isCodeApplied?alert("Promo Code has already been applied!"):alert("Please enter a valid promo code!")}onPayment(){const n=this.agGrid.api.getSelectedNodes();if(0===n.length)return void alert("Please select a row to make a payment");const i=n.map(r=>r.data),a=i.reduce((r,s)=>r+s.totalCalculatedAmount,0);alert(`Payment of ${this.currency} ${Math.round(a)} has been successful!`);for(const r of i)this.cartApiService.payTrip(r.id);this.cartCount=this.cartCount-i.length,this.cartApiService.cartCount$.next(this.cartCount),this.store.dispatch((0,p.Yn)()),localStorage.removeItem(c.qi),this.agGrid.api.applyTransaction({remove:i}),this.calculateTotalPrice(1)}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(u.F0),e.Y36(M.yh),e.Y36(w.E),e.Y36(R.K),e.Y36($.e),e.Y36(N.R))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-cart-page"]],viewQuery:function(n,i){if(1&n&&e.Gf(g.N8,5),2&n){let a;e.iGM(a=e.CRH())&&(i.agGrid=a.first)}},decls:30,vars:18,consts:[[1,"cart-page","width-container","main-content"],[1,"title"],["editType","fullRow","overlayNoRowsTemplate","You have no trips awaiting payment",1,"ag-theme-alpine",2,"width","1050px","min-height","300px",3,"rowData","columnDefs","defaultColDef","rowSelection","suppressClickEdit","gridReady","onClick"],[1,"middle-section"],["mat-raised-button","",3,"click"],[1,"price-section"],[1,"regular","label"],[1,"subtitle"],[1,"bottom-section"],["appearance","outline",1,"promo-wrapper"],["matInput","","type","text","id","promoCode",3,"ngModel","ngModelChange"],["mat-icon-button","","matSuffix","",3,"click"],[1,"bottom-right-section"],[1,"selected-section"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"h1",1),e._uU(2,"Cart"),e.qZA(),e.TgZ(3,"ag-grid-angular",2),e.NdJ("gridReady",function(r){return i.onGridReady(r)})("onClick",function(r){return i.onSelectionChanged(r)}),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"div",3)(6,"button",4),e.NdJ("click",function(){return i.addNewTrip()}),e._uU(7,"+ Add new trip"),e.qZA(),e.TgZ(8,"div",5)(9,"span",6),e._uU(10,"Total "),e.qZA(),e.TgZ(11,"span",7),e._uU(12),e.ALo(13,"async"),e.qZA()()(),e._UZ(14,"mat-divider"),e.TgZ(15,"div",8)(16,"mat-form-field",9)(17,"mat-label"),e._uU(18,"Promo Code"),e.qZA(),e.TgZ(19,"input",10),e.NdJ("ngModelChange",function(r){return i.promoCode=r}),e.qZA(),e.TgZ(20,"button",11),e.NdJ("click",function(){return i.applyPromoCode()}),e.TgZ(21,"mat-icon"),e._uU(22,"navigate_next"),e.qZA()()(),e.TgZ(23,"div",12)(24,"div",13),e._uU(25),e.ALo(26,"async"),e.qZA(),e.TgZ(27,"button",14),e.NdJ("click",function(){return i.onPayment()}),e.ALo(28,"async"),e._uU(29,"Payment"),e.qZA()()()()),2&n&&(e.xp6(3),e.Q6J("rowData",e.lcZ(4,10,i.trips$))("columnDefs",i.colDefs)("defaultColDef",i.defaultColDef)("rowSelection","multiple")("suppressClickEdit",!0),e.xp6(9),e.AsE("",i.currency," ",e.lcZ(13,12,i.totalPrice$),""),e.xp6(7),e.Q6J("ngModel",i.promoCode),e.xp6(6),e.hij(" ",e.lcZ(26,14,i.selectedRows$)," selected "),e.xp6(2),e.Q6J("disabled",e.lcZ(28,16,i.isPaymentDisabled$)))},dependencies:[g.N8,m.KE,m.hX,m.R9,Z.Nt,y.lW,y.RK,I.Hw,G.d,h.Fj,h.JJ,h.On,f.Ov],styles:[".cart-page[_ngcontent-%COMP%]{max-width:1128px;background-color:#fff;margin:0 auto;margin-top:2rem;padding-left:1rem;padding-right:1rem;display:flex;flex-direction:column}.title[_ngcontent-%COMP%]{font-size:24px;line-height:28px;font-weight:700;color:var(--primary-color);margin:10px 0;padding:0 10px}.middle-section[_ngcontent-%COMP%]{margin-top:2rem;margin-bottom:1.5rem;display:flex;flex-direction:row;justify-content:space-between}.regular[_ngcontent-%COMP%]{font-weight:500}.label[_ngcontent-%COMP%]{display:inline-block;padding-right:1rem}.subtitle[_ngcontent-%COMP%]{font-weight:700;font-size:1.5rem;color:#11397e}.bottom-section[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;flex-direction:row;justify-content:space-between}.bottom-right-section[_ngcontent-%COMP%]{width:200px;display:flex;flex-direction:row;justify-content:space-between;align-items:center}@media screen and (max-width: 768px){.bottom-section[_ngcontent-%COMP%]{flex-direction:column}.mat-mdc-form-field[_ngcontent-%COMP%]{width:340px}}"]}),t})();function b(t,l){const i=new Date(t).getTime()+6e4*l;return new Date(i).toLocaleString("en-GB").slice(11,17)}function U(t){const l={weekday:"long",year:"numeric",month:"long",day:"numeric"};return console.log(t.data),new Date(t.data.outboundDepartureDate).toLocaleString("en-GB",l)+", "+t.data.outboundDepartureTime+" - "+b(t.data.outboundDepartureDate,t.data.duration)+(t.data.roundTrip?"<br>"+new Date(t.data.returnDepartureDate).toLocaleString("en-GB",l)+", "+t.data.returnDepartureTime+" - "+b(t.data.returnArrivalDate,t.data.returnArrivalTime):"")}function B(t){return t.data.outboundFlightNo+"  \n"+t.data.returnFlightNo}function E(t){return t.data.originCity+" - "+t.data.destinationCity+(t.data.roundTrip?"<br>"+t.data.destinationCity+" - "+t.data.originCity:"")}function J(t){return t.data.roundTrip?"Round Trip":"One Way"}function j(t){let l=0,n=0,i=0;return t.data.passengers.map(a=>{"adult"===a.ageCategory?l++:"child"===a.ageCategory?n++:"infant"===a.ageCategory&&i++}),l+" x Adult"+(n?"<br>"+n+" x Child":"")+(i?"<br>"+i+" x Infant":"")}var F=o(7574);const H=[{path:"",canActivate:[()=>(0,e.f3M)(F.a).canActivate()],component:O}];let Y=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[u.Bz.forChild(H),u.Bz]}),t})();var L=o(4865);let z=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[f.ez,Y,g.sF,L.m,h.u5]}),t})()}}]);