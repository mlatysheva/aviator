"use strict";(self.webpackChunkaviator=self.webpackChunkaviator||[]).push([[779],{2779:(k,C,o)=>{o.r(C),o.d(C,{CartModule:()=>H});var f=o(6895),e=o(4650),u=o(8252),b=o(4004),T=o(3900),d=o(8505),g=o(3172),P=o(6788),A=o(3413),S=o.n(A),s=o(5092),y=o(1135),p=o(1081),w=o(9653),M=o(7371),R=o(427),m=o(9549),$=o(4144),v=o(4859),N=o(7392),D=o(4850),h=o(4006);let Z=(()=>{class n{constructor(i,t,a,r){this.router=i,this.store=t,this.cartApiService=a,this.userService=r,this.userId=localStorage.getItem(s.E1)||"",this.currency$=this.store.select(P.zT),this.isCodeApplied=!1,this.selectedRows$=new y.X(0),this.isPaymentDisabled$=new y.X(!0),this.colDefs=[{headerName:"No.",checkboxSelection:!0,headerCheckboxSelection:!0,onCellClicked:this.onCellClicked.bind(this),width:120,showDisabledCheckboxes:!0,cellStyle:{color:"#0090BD",fontWeight:"700"},headerClass:"ag-header-cell--centered",valueGetter:I},{headerName:"Flight",cellRenderer:G},{headerName:"Trip Type",width:140,valueGetter:O,sortable:!0,unSortIcon:!0},{headerName:"Date & Time",minWidth:230,cellRenderer:U},{headerName:"Passengers",width:140,cellRenderer:F},{headerName:"Price",width:120,field:"totalAmount",cellStyle:{color:"#7F8906"},sortable:!0,unSortIcon:!0,cellRenderer:this.priceRenderer.bind(this)},{width:100,editable:!1,cellEditorPopup:!0,colId:"moreActions",cellRenderer:this.actionCellRenderer.bind(this),cellStyle:{cursor:"pointer",opacity:"0.5",display:"flex",flexDirection:"row",justifyContent:"space-between"},onCellClicked:this.onActionMenuClicked.bind(this),cellEditor:"agSelectCellEditor"}],this.defaultColDef={resizable:!0,autoHeight:!0,wrapText:!0,wrapHeaderText:!0,autoHeaderHeight:!0,cellStyle:{padding:"1rem",lineHeight:"1.5rem",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"500",textAlign:"center"},cellClass:"cellCenter",onCellClicked:this.onSelectionChanged.bind(this)},this.navigationSubscription=this.router.events.subscribe(c=>{c instanceof u.m2&&localStorage.removeItem(s.qi)})}ngOnInit(){this.currency$.subscribe(i=>{this.currency=S()(i)})}ngOnDestroy(){this.navigationSubscription&&this.navigationSubscription.unsubscribe()}onGridReady(i){this.user$=this.userService.getUserById(this.userId),this.user$.subscribe(t=>{this.promoCode=t.promoCode,this.isCodeApplied=t.isCodeApplied||!1}),this.trips$=this.cartApiService.getUnpaidTripsByUserId(this.userId),this.trips$.subscribe(t=>{this.cartApiService.cartCount$.next(t.length),this.cartCount=t.length,this.isPaymentDisabled$.next(0===t.length)}),this.calculateTotalPrice(1),this.selectedRows$.next(this.agGrid.api.getSelectedNodes().length)}onCellClicked(i){this.selectedRows$.next(this.agGrid.api.getSelectedNodes().length)}onSelectionChanged(i){this.selectedRows$.next(this.agGrid.api.getSelectedNodes().length)}priceRenderer(i){return`${this.currency} ${Math.round(i.data.totalAmount.sumPrice+i.data.totalAmount.totalTax+(i.data.totalAmountFrom?.sumPrice||0)+(i.data.totalAmountFrom?.totalTax||0))}`}actionCellRenderer(i){const t=document.createElement("div");return t.innerHTML='\n      <div class="material-icons" title="Edit" data-action="edit">edit</div>\n      <div class="material-icons" title="Delete" data-action="delete">delete</div>\n    ',t}calculateTotalPrice(i=1){this.totalPrice$=this.trips$.pipe((0,b.U)(t=>{const a=t.reduce((r,c)=>r+(c.totalCalculatedAmount||0),0);return Math.round(a*i)}))}onActionMenuClicked(i){if(this.selectedRows=this.agGrid?.gridOptions?.api?.getSelectedNodes().length,"moreActions"===i.column.colId&&i.event.target.dataset.action){const t=i.event.target.dataset.action,a=i.node.data.id;"edit"===t&&(localStorage.setItem(s.qi,a),this.cartApiService.getTrip(a).subscribe(c=>{this.store.dispatch((0,p.Hr)({...c})),this.router.navigate(["flights"])})),"delete"===t&&this.cartApiService.deleteTrip(a,this.userId).pipe((0,T.w)(()=>this.cartApiService.getUnpaidTripsByUserId(this.userId)),(0,d.b)(()=>this.cartApiService.cartCount$.next(this.cartCount-1)),(0,d.b)(()=>this.calculateTotalPrice(1)),(0,d.b)(()=>this.store.dispatch((0,p.Yn)())),(0,d.b)(()=>localStorage.removeItem(s.qi)),(0,d.b)(()=>i.api.applyTransaction({remove:[i.node.data]}))).subscribe()}}addNewTrip(){this.router.navigate(["main"]),localStorage.removeItem(s.qi)}applyPromoCode(){this.promoCode&&!this.isCodeApplied?(this.calculateTotalPrice(.95),this.isCodeApplied=!0,this.trips$=this.cartApiService.applyPromoCode(this.userId,.95),alert(`Promo Code "${this.promoCode}" with a 5% discount will be applied!`)):this.isCodeApplied?alert("Promo Code has already been applied!"):alert("Please enter a valid promo code!")}onPayment(){const i=this.agGrid.api.getSelectedNodes();if(0===i.length)return void alert("Please select a row to make a payment");const t=i.map(r=>r.data);alert(`Payment of ${this.currency} ${Math.round(t[0].totalCalculatedAmount)} has been successful!`);for(const r of t)this.cartApiService.payTrip(r.id);this.cartApiService.cartCount$.next(this.cartCount-t.length),this.store.dispatch((0,p.Yn)()),localStorage.removeItem(s.qi),this.agGrid.api.applyTransaction({remove:t}),this.calculateTotalPrice(1)}}return n.\u0275fac=function(i){return new(i||n)(e.Y36(u.F0),e.Y36(w.yh),e.Y36(M.E),e.Y36(R.K))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-cart-page"]],viewQuery:function(i,t){if(1&i&&e.Gf(g.N8,5),2&i){let a;e.iGM(a=e.CRH())&&(t.agGrid=a.first)}},decls:30,vars:18,consts:[[1,"cart-page","width-container","main-content"],[1,"title"],["editType","fullRow","overlayNoRowsTemplate","You have no trips awaiting payment",1,"ag-theme-alpine",2,"width","1050px","min-height","300px",3,"rowData","columnDefs","defaultColDef","rowSelection","suppressClickEdit","gridReady","onClick"],[1,"middle-section"],["mat-raised-button","",3,"click"],[1,"price-section"],[1,"regular","label"],[1,"subtitle"],[1,"bottom-section"],["appearance","outline",1,"promo-wrapper"],["matInput","","type","text","id","promoCode",3,"ngModel","ngModelChange"],["mat-icon-button","","matSuffix","",3,"click"],[1,"bottom-right-section"],[1,"selected-section"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"h1",1),e._uU(2,"Cart"),e.qZA(),e.TgZ(3,"ag-grid-angular",2),e.NdJ("gridReady",function(r){return t.onGridReady(r)})("onClick",function(r){return t.onSelectionChanged(r)}),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"div",3)(6,"button",4),e.NdJ("click",function(){return t.addNewTrip()}),e._uU(7,"+ Add new trip"),e.qZA(),e.TgZ(8,"div",5)(9,"span",6),e._uU(10,"Total "),e.qZA(),e.TgZ(11,"span",7),e._uU(12),e.ALo(13,"async"),e.qZA()()(),e._UZ(14,"mat-divider"),e.TgZ(15,"div",8)(16,"mat-form-field",9)(17,"mat-label"),e._uU(18,"Promo Code"),e.qZA(),e.TgZ(19,"input",10),e.NdJ("ngModelChange",function(r){return t.promoCode=r}),e.qZA(),e.TgZ(20,"button",11),e.NdJ("click",function(){return t.applyPromoCode()}),e.TgZ(21,"mat-icon"),e._uU(22,"navigate_next"),e.qZA()()(),e.TgZ(23,"div",12)(24,"div",13),e._uU(25),e.ALo(26,"async"),e.qZA(),e.TgZ(27,"button",14),e.NdJ("click",function(){return t.onPayment()}),e.ALo(28,"async"),e._uU(29,"Payment"),e.qZA()()()()),2&i&&(e.xp6(3),e.Q6J("rowData",e.lcZ(4,10,t.trips$))("columnDefs",t.colDefs)("defaultColDef",t.defaultColDef)("rowSelection","multiple")("suppressClickEdit",!0),e.xp6(9),e.AsE("",t.currency," ",e.lcZ(13,12,t.totalPrice$),""),e.xp6(7),e.Q6J("ngModel",t.promoCode),e.xp6(6),e.hij(" ",e.lcZ(26,14,t.selectedRows$)," selected "),e.xp6(2),e.Q6J("disabled",e.lcZ(28,16,t.isPaymentDisabled$)))},dependencies:[g.N8,m.KE,m.hX,m.R9,$.Nt,v.lW,v.RK,N.Hw,D.d,h.Fj,h.JJ,h.On,f.Ov],styles:[".cart-page[_ngcontent-%COMP%]{max-width:1128px;background-color:#fff;margin:0 auto;margin-top:2rem;padding-left:1rem;padding-right:1rem;display:flex;flex-direction:column}.title[_ngcontent-%COMP%]{font-size:24px;line-height:28px;font-weight:700;color:var(--primary-color);margin:10px 0;padding:0 10px}.middle-section[_ngcontent-%COMP%]{margin-top:2rem;margin-bottom:1.5rem;display:flex;flex-direction:row;justify-content:space-between}.regular[_ngcontent-%COMP%]{font-weight:500}.label[_ngcontent-%COMP%]{display:inline-block;padding-right:1rem}.subtitle[_ngcontent-%COMP%]{font-weight:700;font-size:1.5rem;color:#11397e}.bottom-section[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;flex-direction:row;justify-content:space-between}.bottom-right-section[_ngcontent-%COMP%]{width:200px;display:flex;flex-direction:row;justify-content:space-between;align-items:center}@media screen and (max-width: 768px){.bottom-section[_ngcontent-%COMP%]{flex-direction:column}.mat-mdc-form-field[_ngcontent-%COMP%]{width:340px}}"]}),n})();function I(n){return n.data.outboundFlightNo+"  \n"+n.data.returnFlightNo}function G(n){return n.data.originCity+" - "+n.data.destinationCity+(n.data.roundTrip?"<br>"+n.data.destinationCity+" - "+n.data.originCity:"")}function O(n){return n.data.roundTrip?"Round Trip":"One Way"}function U(n){const l={weekday:"long",year:"numeric",month:"long",day:"numeric"};return new Date(n.data.outboundDepartureDate).toLocaleString("en-GB",l)+(n.data.roundTrip?"<br>"+new Date(n.data.returnDepartureDate).toLocaleString("en-GB",l):"")}function F(n){let l=0,i=0,t=0;return n.data.passengers.map(a=>{"adult"===a.ageCategory?l++:"child"===a.ageCategory?i++:"infant"===a.ageCategory&&t++}),l+" x Adult"+(i?"<br>"+i+" x Child":"")+(t?"<br>"+t+" x Infant":"")}var J=o(7574);const B=[{path:"",canActivate:[()=>(0,e.f3M)(J.a).canActivate()],component:Z}];let E=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[u.Bz.forChild(B),u.Bz]}),n})();var j=o(4865);let H=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[f.ez,E,g.sF,j.m,h.u5]}),n})()}}]);